<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>í”„ë¡œì íŠ¸ ë°œí‘œ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .slide-container { 
            width: 1280px; 
            height: 720px; 
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 60px;
            display: flex;
            flex-direction: column;
        }
        .info-box {
            background: white;
            border-radius: 1rem;
            padding: 20px 30px;
            width: fit-content;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #3b82f6;
        }
        .code-box {
            background: white;
            border-radius: 1rem;
            padding: 30px;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #10b981;
        }
        .code-content {
            display: grid;
            grid-template-columns: 1.4fr 0.6fr; /* ì½”ë“œ ê¸¸ì´ê°€ ê¸¸ì–´ ë¹„ìœ¨ ì¡°ì • */
            gap: 20px;
            flex: 1;
            overflow: hidden;
        }
        .code-section {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
        }
        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            overflow: auto;
            flex: 1;
            font-family: 'Courier New', monospace;
            font-size: 12px; /* ì½”ë“œ ì–‘ì´ ë§ì•„ í°íŠ¸ í¬ê¸° ì¡°ì • */
            line-height: 1.5;
        }
        .explanation-box {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            overflow: auto;
            flex: 1;
            border: 1px solid #e2e8f0;
        }
        .explanation-item {
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e2e8f0;
        }
        .explanation-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .explanation-title {
            font-size: 15px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 6px;
        }
        .explanation-text {
            font-size: 14px;
            color: #6b7280;
            line-height: 1.5;
        }
        .info-title {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 5px;
        }
        .info-subtitle {
            font-size: 16px;
            font-weight: 500;
            color: #6b7280;
        }
        .code-title {
            font-size: 22px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 20px;
        }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    </style>
</head>
<body>
<div class="slide-container">
    <div class="info-box">
        <div class="info-title">ê´€ì‹¬ì‚¬ ê´€ë¦¬</div>
        <div class="info-subtitle">No-Offset ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§€ë„¤ì´ì…˜ ëª©ë¡ ì¡°íšŒ</div>
    </div>
    <div class="code-box">
        <div class="code-title">interestList & Cursor Extraction</div>
        <div class="code-content">
            <div class="code-section">
                <div class="section-title">ğŸ’» Java Source Code</div>
<pre>
<span style="color: #f472b6">@Override</span>
<span style="color: #f472b6">@Transactional(readOnly = true)</span>
<span style="color: #c084fc">public</span> <span style="color: #fbbf24">CursorPageResponseInterestDto</span> <span style="color: #60a5fa">interestList</span>(<span style="color: #fbbf24">UUID</span> userId, <span style="color: #fbbf24">InterestSearchRequest</span> request) {
    <span style="color: #6b7280">// 1. ë°ì´í„° ì¡°íšŒ ë° ì»¤ì„œ ì •ë³´ ì¶”ì¶œ</span>
    <span style="color: #fbbf24">List</span>&lt;<span style="color: #fbbf24">Interest</span>&gt; interestList = interestRepository.<span style="color: #60a5fa">search</span>(request);
    <span style="color: #fbbf24">Long</span> totalElements = interestRepository.<span style="color: #60a5fa">totalElements</span>(request);
    <span style="color: #fbbf24">CursorPagingInfo</span> nextCursor = <span style="color: #60a5fa">extractCursorInfo</span>(interestList, request.<span style="color: #60a5fa">orderBy</span>(), request.<span style="color: #60a5fa">limit</span>());
    <span style="color: #c084fc">if</span> (interestList.<span style="color: #60a5fa">isEmpty</span>()) <span style="color: #c084fc">return new</span> <span style="color: #fbbf24">CursorPageResponseInterestDto</span>();
    <span style="color: #c084fc">if</span> (nextCursor.<span style="color: #60a5fa">hasNext</span>()) {
        interestList = interestList.<span style="color: #60a5fa">subList</span>(<span style="color: #a78bfa">0</span>, request.<span style="color: #60a5fa">limit</span>());
    }
    <span style="color: #6b7280">// 2. ì‚¬ìš©ì êµ¬ë… ì—¬ë¶€ ë§¤í•‘ (N+1 ë°©ì§€)</span>
    <span style="color: #fbbf24">List</span>&lt;<span style="color: #fbbf24">UUID</span>&gt; interestIds = interestList.<span style="color: #60a5fa">stream</span>().<span style="color: #60a5fa">map</span>(Interest::<span style="color: #60a5fa">getId</span>).<span style="color: #60a5fa">toList</span>();
    <span style="color: #fbbf24">List</span>&lt;<span style="color: #fbbf24">UUID</span>&gt; userInterestIds = subscribeRepository.<span style="color: #60a5fa">findByUserIdAndInterestIdIn</span>(userId, interestIds)
            .<span style="color: #60a5fa">stream</span>().<span style="color: #60a5fa">map</span>(Subscribe::<span style="color: #60a5fa">getInterestId</span>).<span style="color: #60a5fa">toList</span>();
    <span style="color: #fbbf24">List</span>&lt;<span style="color: #fbbf24">InterestDto</span>&gt; interestDtoList = interestMapper.<span style="color: #60a5fa">toDtoList</span>(interestList, userInterestIds);
    <span style="color: #c084fc">return</span> <span style="color: #fbbf24">CursorPageResponseInterestDto</span>.<span style="color: #60a5fa">builder</span>()
            .<span style="color: #60a5fa">content</span>(interestDtoList)
            .<span style="color: #60a5fa">nextCursor</span>(nextCursor.<span style="color: #60a5fa">nextCursor</span>())
            .<span style="color: #60a5fa">nextAfter</span>(nextCursor.<span style="color: #60a5fa">nextAfter</span>())
            .<span style="color: #60a5fa">hasNext</span>(nextCursor.<span style="color: #60a5fa">hasNext</span>())
            .<span style="color: #60a5fa">build</span>();
}
<span style="color: #c084fc">private</span> <span style="color: #fbbf24">CursorPagingInfo</span> <span style="color: #60a5fa">extractCursorInfo</span>(<span style="color: #fbbf24">List</span>&lt;<span style="color: #fbbf24">Interest</span>&gt; interestList, <span style="color: #fbbf24">String</span> orderBy, <span style="color: #c084fc">int</span> limit) {
<span style="color: #c084fc">boolean</span> hasNext = interestList.<span style="color: #60a5fa">size</span>() == limit + <span style="color: #a78bfa">1</span>;
<span style="color: #fbbf24">String</span> nextCursor = <span style="color: #c084fc">null</span>;
<span style="color: #fbbf24">String</span> nextAfter = <span style="color: #c084fc">null</span>;
    <span style="color: #c084fc">if</span> (hasNext) {
        interestList = interestList.<span style="color: #60a5fa">subList</span>(<span style="color: #a78bfa">0</span>, limit);
        <span style="color: #fbbf24">Interest</span> lastItem = interestList.<span style="color: #60a5fa">get</span>(interestList.<span style="color: #60a5fa">size</span>() - <span style="color: #a78bfa">1</span>); 
        nextCursor = orderBy.<span style="color: #60a5fa">equalsIgnoreCase</span>(<span style="color: #a78bfa">"name"</span>) ? lastItem.<span style="color: #60a5fa">getName</span>() 
                   : lastItem.<span style="color: #60a5fa">getSubscribeCount</span>().<span style="color: #60a5fa">toString</span>();
        nextAfter = lastItem.<span style="color: #60a5fa">getCreatedAt</span>().<span style="color: #60a5fa">toString</span>();
    }
    <span style="color: #c084fc">return new</span> <span style="color: #fbbf24">CursorPagingInfo</span>(nextCursor, nextAfter, hasNext);
}</pre>
</div>
            <div class="code-section">
                <div class="section-title">ğŸ“ ë¡œì§ ìƒì„¸ ë¶„ì„</div>
                <div class="explanation-box">
                    <div class="explanation-item">
                        <div class="explanation-title">Cursor Paging ì›ë¦¬ (Limit + 1)</div>
                        <div class="explanation-text">
                            ìš”ì²­í•œ <code>limit</code>ë³´ë‹¤ 1ê°œë¥¼ ë” ì¡°íšŒí•˜ì—¬(limit+1), ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€(<code>hasNext</code>)ë¥¼ íŒë‹¨í•©ë‹ˆë‹¤. ë‹¤ìŒ í˜ì´ì§€ê°€ ìˆë‹¤ë©´ ë§ˆì§€ë§‰ ìš”ì†Œë¥¼ ì˜ë¼ë‚´ê³ (subList), í•´ë‹¹ ìš”ì†Œì˜ ê°’ì„ ì»¤ì„œë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
                        </div>
                    </div>
                    <div class="explanation-item">
                        <div class="explanation-title">ì‚¬ìš©ì êµ¬ë… ì •ë³´ ë§¤í•‘ (N+1 ë°©ì§€)</div>
                        <div class="explanation-text">
                            ë°˜í™˜ëœ ê´€ì‹¬ì‚¬ ëª©ë¡ì— ëŒ€í•´ ì‚¬ìš©ìì˜ êµ¬ë… ì—¬ë¶€ë¥¼ í‘œì‹œí•´ì•¼ í•©ë‹ˆë‹¤. ë°˜ë³µë¬¸ ë‚´ ì¿¼ë¦¬ ì‹¤í–‰ì„ ë§‰ê¸° ìœ„í•´, <code>findByUserIdAndInterestIdIn</code>ìœ¼ë¡œ êµ¬ë… ì •ë³´ë¥¼ í•œ ë²ˆì— ì¡°íšŒ(IN ì¿¼ë¦¬)í•œ í›„ ë§¤í•‘í•©ë‹ˆë‹¤.
                        </div>
                    </div>
                    <div class="explanation-item">
                        <div class="explanation-title">ë™ì  ì •ë ¬ ê¸°ì¤€ (OrderBy)</div>
                        <div class="explanation-text">
                            ì •ë ¬ ê¸°ì¤€ì´ 'ì´ë¦„(name)'ì¸ì§€ 'êµ¬ë…ì ìˆ˜'ì¸ì§€ì— ë”°ë¼ Next Cursorì— ë‹´ê¸°ëŠ” ê°’ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ì´ë¥¼ <code>extractCursorInfo</code> ë©”ì„œë“œì—ì„œ ë¶„ê¸° ì²˜ë¦¬í•˜ì—¬ í™•ì¥ì„±ì„ í™•ë³´í–ˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                    <div class="explanation-item">
                        <div class="explanation-title">Response DTO ì¡°ë¦½</div>
                        <div class="explanation-text">
                            ì½˜í…ì¸ , ì»¤ì„œ ì •ë³´, ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€ ë“±ì„ <code>CursorPageResponseInterestDto</code>ë¡œ ìº¡ìŠí™”í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ëŠ” ë¬´í•œ ìŠ¤í¬ë¡¤ ë“±ì„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>