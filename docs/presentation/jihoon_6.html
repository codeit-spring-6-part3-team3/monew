<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>í”„ë¡œì íŠ¸ ë°œí‘œ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .slide-container { 
            width: 1280px; 
            height: 720px; 
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 60px;
            display: flex;
            flex-direction: column;
        }
        .info-box {
            background: white;
            border-radius: 1rem;
            padding: 20px 30px;
            width: fit-content;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #3b82f6;
        }
        .code-box {
            background: white;
            border-radius: 1rem;
            padding: 30px;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #10b981;
        }
        .code-content {
            display: grid;
            grid-template-columns: 1.3fr 0.7fr;
            gap: 20px;
            flex: 1;
            overflow: hidden;
        }
        .code-section {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
        }
        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            overflow: auto;
            flex: 1;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.5;
        }
        .explanation-box {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            overflow: auto;
            flex: 1;
            border: 1px solid #e2e8f0;
        }
        .explanation-item {
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e2e8f0;
        }
        .explanation-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .explanation-title {
            font-size: 15px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 6px;
        }
        .explanation-text {
            font-size: 14px;
            color: #6b7280;
            line-height: 1.5;
        }
        .info-title {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 5px;
        }
        .info-subtitle {
            font-size: 16px;
            font-weight: 500;
            color: #6b7280;
        }
        .code-title {
            font-size: 22px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 20px;
        }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    </style>
</head>
<body>
<div class="slide-container">
    <div class="info-box">
        <div class="info-title">êµ¬ë… ì¡°íšŒ</div>
        <div class="info-subtitle">Batch ì¡°íšŒ ë° Map ë§¤í•‘ì„ í†µí•œ N+1 ë¬¸ì œ í•´ê²°</div>
    </div>
    <div class="code-box">
        <div class="code-title">subscribeUser & toDto ë©”ì„œë“œ</div>
        <div class="code-content">
            <div class="code-section">
                <div class="section-title">ğŸ’» Java Source Code</div>
<pre>
<span style="color: #f472b6">@Override</span>
<span style="color: #f472b6">@Transactional(readOnly = true)</span>
<span style="color: #c084fc">public</span> <span style="color: #fbbf24">List</span>&lt;<span style="color: #fbbf24">SubscribeDto</span>&gt; <span style="color: #60a5fa">subscribeUser</span>(<span style="color: #fbbf24">UUID</span> userId) {
    userRepository.<span style="color: #60a5fa">findById</span>(userId)
            .<span style="color: #60a5fa">orElseThrow</span>(<span style="color: #fbbf24">UserNotFoundException</span>::<span style="color: #c084fc">new</span>);
    <span style="color: #fbbf24">List</span>&lt;<span style="color: #fbbf24">Subscribe</span>&gt; subscribes = subscribeRepository.<span style="color: #60a5fa">findByUserId</span>(userId);
    <span style="color: #c084fc">if</span> (subscribes.<span style="color: #60a5fa">isEmpty</span>()) <span style="color: #c084fc">return new</span> <span style="color: #fbbf24">ArrayList</span><>();
    <span style="color: #6b7280">// 1. êµ¬ë… ëª©ë¡ì—ì„œ ê´€ì‹¬ì‚¬ IDë§Œ ì¶”ì¶œ</span>
    <span style="color: #fbbf24">List</span>&lt;<span style="color: #fbbf24">UUID</span>&gt; interestId = subscribes.<span style="color: #60a5fa">stream</span>()
            .<span style="color: #60a5fa">map</span>(Subscribe::<span style="color: #60a5fa">getInterestId</span>)
            .<span style="color: #60a5fa">toList</span>();
    <span style="color: #6b7280">// 2. ê´€ì‹¬ì‚¬ ì¼ê´„ ì¡°íšŒ (IN Query) í›„ Map ë³€í™˜</span>
    <span style="color: #fbbf24">Map</span>&lt;<span style="color: #fbbf24">UUID</span>, <span style="color: #fbbf24">Interest</span>&gt; interests = interestRepository
            .<span style="color: #60a5fa">findByIdIn</span>(interestId).<span style="color: #60a5fa">stream</span>()
            .<span style="color: #60a5fa">collect</span>(<span style="color: #fbbf24">Collectors</span>.<span style="color: #60a5fa">toMap</span>(
                Interest::<span style="color: #60a5fa">getId</span>, <span style="color: #fbbf24">Function</span>.<span style="color: #60a5fa">identity</span>() 
            ));
    <span style="color: #c084fc">return</span> <span style="color: #60a5fa">toDto</span>(subscribes, interests);
}
<span style="color: #c084fc">public</span> <span style="color: #fbbf24">List</span>&lt;<span style="color: #fbbf24">SubscribeDto</span>&gt; <span style="color: #60a5fa">toDto</span>(<span style="color: #fbbf24">List</span>&lt;<span style="color: #fbbf24">Subscribe</span>&gt; subscribes, <span style="color: #fbbf24">Map</span>&lt;<span style="color: #fbbf24">UUID</span>, <span style="color: #fbbf24">Interest</span>&gt; interests) {
<span style="color: #fbbf24">List</span>&lt;<span style="color: #fbbf24">SubscribeDto</span>&gt; subscribeDtoList = <span style="color: #c084fc">new</span> <span style="color: #fbbf24">ArrayList</span><>();
<span style="color: #c084fc">for</span> (<span style="color: #fbbf24">Subscribe</span> subscribe : subscribes) {
<span style="color: #6b7280">// 3. Mapì—ì„œ O(1)ë¡œ ì¡°íšŒí•˜ì—¬ ë§¤í•‘</span>
<span style="color: #fbbf24">Interest</span> interest = interests.<span style="color: #60a5fa">get</span>(subscribe.<span style="color: #60a5fa">getInterestId</span>());
        <span style="color: #fbbf24">SubscribeDto</span> subscribeDto = subscribeMapper.<span style="color: #60a5fa">toDto</span>(subscribe, interest);
        subscribeDtoList.<span style="color: #60a5fa">add</span>(subscribeDto);
    }
    <span style="color: #c084fc">return</span> subscribeDtoList;
}</pre>
</div>
            <div class="code-section">
                <div class="section-title">ğŸ“ ë¡œì§ ìƒì„¸ ë¶„ì„</div>
                <div class="explanation-box">
                    <div class="explanation-item">
                        <div class="explanation-title">N+1 ë¬¸ì œ ì›ì¸ ë° í•´ê²°</div>
                        <div class="explanation-text">
                            êµ¬ë… ë¦¬ìŠ¤íŠ¸ë¥¼ ìˆœíšŒí•˜ë©° ë§¤ë²ˆ <code>findById</code>ë¡œ ê´€ì‹¬ì‚¬ë¥¼ ì¡°íšŒí•˜ë©´ ì¿¼ë¦¬ê°€ Në²ˆ ë°œìƒí•©ë‹ˆë‹¤. ì´ë¥¼ <code>findByIdIn</code>ì„ ì‚¬ìš©í•˜ì—¬ 1ë²ˆì˜ ì¿¼ë¦¬ë¡œ ëª¨ë“  ì—°ê´€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ ìµœì í™”í–ˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                    <div class="explanation-item">
                        <div class="explanation-title">Mapì„ í™œìš©í•œ ë§¤í•‘ ì„±ëŠ¥ í–¥ìƒ</div>
                        <div class="explanation-text">
                            ì¡°íšŒí•œ ê´€ì‹¬ì‚¬ ë¦¬ìŠ¤íŠ¸ë¥¼ <code>Map&lt;UUID, Interest&gt;</code>ë¡œ ë³€í™˜í–ˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ DTO ë³€í™˜ ë°˜ë³µë¬¸ ë‚´ë¶€ì—ì„œ ë°ì´í„°ë¥¼ ì°¾ì„ ë•Œ ë¦¬ìŠ¤íŠ¸ íƒìƒ‰ O(N) ëŒ€ì‹  O(1)ì˜ ì†ë„ë¡œ ë¹ ë¥´ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                    <div class="explanation-item">
                        <div class="explanation-title">Stream API & Collectors</div>
                        <div class="explanation-text">
                            <code>Collectors.toMap(Key, Value)</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ Entityì˜ IDë¥¼ Keyë¡œ, Entity ê°ì²´ ìì²´(<code>Function.identity()</code>)ë¥¼ Valueë¡œ ê°–ëŠ” ë§µì„ íš¨ìœ¨ì ìœ¼ë¡œ ìƒì„±í–ˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                    <div class="explanation-item">
                        <div class="explanation-title">ì±…ì„ ë¶„ë¦¬ (Helper Method)</div>
                        <div class="explanation-text">
                            ë°ì´í„° ì¡°íšŒ ë¡œì§(<code>subscribeUser</code>)ê³¼ ê°ì²´ ì¡°ë¦½/ë³€í™˜ ë¡œì§(<code>toDto</code>)ì„ ë¶„ë¦¬í•˜ì—¬ ì½”ë“œì˜ ê°€ë…ì„±ì„ ë†’ì´ê³  ìœ ì§€ë³´ìˆ˜ë¥¼ ìš©ì´í•˜ê²Œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>